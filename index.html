<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa de Escolas – Planejamento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
  }

  #map {
    height: 100vh;
    width: 100%;
  }

  .panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fff;
    max-height: 40%;
    overflow-y: auto;
    border-top: 2px solid #ccc;
    padding: 10px;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.2);
    font-size: 14px;
  }

  .selected-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
  }

  button {
    font-size: 12px;
  }
</style>
</head>

<body>

<div id="map"></div>

<div class="panel">
  <strong>Escolas selecionadas</strong>
  <div id="selectedList"></div>
</div>

<script>
/* =========================
   DADOS
========================= */

const pontoPartida = [-7.194722139209482, -39.31536456230205];

const escolas = [
  { nome: "ALAYDE OLIVEIRA DE ANDRADE CEI", lat: -7.22591062068273, lng: -39.2990276371078 },
  { nome: "HELENA VIEIRA DOS SANTOS EMEI", lat: -7.21989883926041, lng: -39.337978081951 },
  { nome: "IRMÃ ANA TEREZINHA EMEI", lat: -7.20154173144659, lng: -39.2706373538735 },
  { nome: "PROFª FRANCISCA LETICIA DO AMARAL BRASILEIRO EMEI", lat: -7.22819953348265, lng: -39.3401421154183 },
  { nome: "PROFª MARIA BERNADETE DE ALENCAR SANTOS EMEI", lat: -7.23045717488514, lng: -39.3203756324349 }
];

/* =========================
   MAPA
========================= */

const map = L.map("map").setView(pontoPartida, 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap"
}).addTo(map);

// SEINFRA
L.circleMarker(pontoPartida, {
  radius: 8,
  color: "#e31a1c",
  fillColor: "#e31a1c",
  fillOpacity: 1
}).addTo(map).bindPopup("SEINFRA");

/* =========================
   SELEÇÃO
========================= */

const selecionadas = new Set();
const selectedList = document.getElementById("selectedList");

function atualizarLista() {
  selectedList.innerHTML = "";

  selecionadas.forEach(index => {
    const s = escolas[index];

    const div = document.createElement("div");
    div.className = "selected-item";

    const span = document.createElement("span");
    span.textContent = s.nome;

    const btn = document.createElement("button");
    btn.textContent = "Remover";
    btn.onclick = () => {
      selecionadas.delete(index);
      atualizarLista();
    };

    div.appendChild(span);
    div.appendChild(btn);
    selectedList.appendChild(div);
  });
}

/* =========================
   MARCADORES
========================= */

escolas.forEach((s, index) => {
  const marker = L.circleMarker([s.lat, s.lng], {
    radius: 6,
    color: "#1f78b4",
    fillColor: "#1f78b4",
    fillOpacity: 0.9
  }).addTo(map);

  const popupContent = document.createElement("div");

  const title = document.createElement("div");
  title.textContent = s.nome;
  title.style.fontWeight = "bold";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.style.marginTop = "6px";

  checkbox.onchange = () => {
    if (checkbox.checked) {
      selecionadas.add(index);
    } else {
      selecionadas.delete(index);
    }
    atualizarLista();
  };

  popupContent.appendChild(title);
  popupContent.appendChild(checkbox);

  marker.bindPopup(popupContent);
});
</script>

</body>
</html>
